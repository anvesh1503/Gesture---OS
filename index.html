<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesture OS</title>
    <link rel="stylesheet" href="style.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-logo">Gesture OS</div>
        <div class="loader"></div>
        <div class="loading-text">Initializing System...</div>
    </div>

    <!-- Background -->
    <div id="wallpaper"></div>

    <!-- Desktop Environment -->
    <div id="desktop">
        <!-- Icons are dynamically added or hardcoded here -->
        <div class="desktop-icon" data-app="calculator">
            <img src="https://cdn-icons-png.flaticon.com/512/2344/2344132.png" alt="Calc">
            <span>Calculator</span>
        </div>
        <div class="desktop-icon" data-app="notepad">
            <img src="https://cdn-icons-png.flaticon.com/512/2599/2599651.png" alt="Notepad">
            <span>Notepad</span>
        </div>
        <div class="desktop-icon" data-app="browser">
            <!-- Replaced Image with Modern Icon -->
            <i class="fa-solid fa-globe"></i>
            <span>Browser</span>
        </div>
        <div class="desktop-icon" data-app="settings">
            <img src="https://cdn-icons-png.flaticon.com/512/2040/2040504.png" alt="Settings">
            <span>Settings</span>
        </div>

        <!-- Recycle Bin (Visual Only) -->
        <div class="desktop-icon" style="position: absolute; bottom: 80px; right: 20px;">
            <img src="https://cdn-icons-png.flaticon.com/512/3133/3133663.png" alt="Trash">
            <span>Trash</span>
        </div>
    </div>

    <!-- Window Container (Windows injected here) -->
    <!-- Calculator Window -->
    <div class="window" id="win-calculator" style="display: none; left: 100px; top: 100px;">
        <div class="title-bar">
            <span class="window-title">Calculator</span>
            <div class="window-controls">
                <button class="control-btn min minimize"></button>
                <button class="control-btn max"></button>
                <button class="control-btn close"></button>
            </div>
        </div>
        <div class="window-content">
            <input type="text" class="calc-display" id="calc-display" value="0" readonly>
            <div class="calc-grid">
                <button class="calc-btn" id="btn-7">7</button>
                <button class="calc-btn" id="btn-8">8</button>
                <button class="calc-btn" id="btn-9">9</button>
                <button class="calc-btn op" id="btn-divide">/</button>
                <button class="calc-btn" id="btn-4">4</button>
                <button class="calc-btn" id="btn-5">5</button>
                <button class="calc-btn" id="btn-6">6</button>
                <button class="calc-btn op" id="btn-multiply">*</button>
                <button class="calc-btn" id="btn-1">1</button>
                <button class="calc-btn" id="btn-2">2</button>
                <button class="calc-btn" id="btn-3">3</button>
                <button class="calc-btn op" id="btn-subtract">-</button>
                <button class="calc-btn" id="btn-0">0</button>
                <button class="calc-btn" id="btn-clear">C</button>
                <button class="calc-btn eq" id="btn-equals">=</button>
                <button class="calc-btn op" id="btn-add">+</button>
            </div>
        </div>
    </div>

    <!-- Notepad Window -->
    <div class="window" id="win-notepad" style="display: none; left: 150px; top: 150px; width: 500px; height: 400px;">
        <div class="title-bar">
            <span class="window-title">Notepad</span>
            <div class="window-controls">
                <button class="control-btn min minimize"></button>
                <button class="control-btn max"></button>
                <button class="control-btn close"></button>
            </div>
        </div>
        <div class="window-content">
            <textarea placeholder="Start typing..."></textarea>
        </div>
    </div>

    <!-- Browser Window -->
    <div class="window" id="win-browser" style="display: none; left: 200px; top: 120px;">
        <div class="title-bar">
            <span class="window-title">Browser</span>
            <div class="window-controls">
                <button class="control-btn min minimize"></button>
                <button class="control-btn max"></button>
                <button class="control-btn close"></button>
            </div>
        </div>
        <div class="window-content">
            <div class="browser-bar">
                <button class="browser-nav-btn" id="btn-browser-back"><i class="fa-solid fa-arrow-left"></i></button>
                <button class="browser-nav-btn" id="btn-browser-reload"><i
                        class="fa-solid fa-rotate-right"></i></button>
                <div class="url-bar">
                    <input type="text" id="browser-url" class="url-input" placeholder="Enter URL or search..."
                        value="about:blank">
                    <button id="btn-browser-go"
                        style="background: transparent; border: none; color: var(--accent); cursor: pointer; padding: 0 10px; font-size: 18px; font-weight: bold;">â†’</button>
                </div>
            </div>
            <div class="browser-content" id="browser-frame">
                <div style="padding: 40px; text-align: center; color: #999;">
                    <i class="fa-solid fa-globe" style="font-size: 64px; margin-bottom: 20px; color: #00d2d3;"></i>
                    <p>Enter a URL or search term above</p>
                </div>
            </div>
            <iframe id="browser-frame" class="browser-content"
                sandbox="allow-same-origin allow-scripts allow-popups allow-forms" src="about:blank"></iframe>
        </div>
    </div>

    <!-- Settings Window -->
    <div class="window" id="win-settings" style="display: none; left: 250px; top: 180px; width: 450px; height: 350px;">
        <div class="title-bar">
            <span class="window-title">Settings</span>
            <div class="window-controls">
                <button class="control-btn min minimize"></button>
                <button class="control-btn max"></button>
                <button class="control-btn close"></button>
            </div>
        </div>
        <div class="window-content" style="padding: 20px;">
            <h3 style="margin-top: 0;">Gesture OS Settings</h3>
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px;">
                    <strong>Voice Control:</strong>
                    <span id="voice-status" style="margin-left: 10px; color: var(--text-muted);">Off</span>
                </label>
                <div id="voice-setting-row"
                    style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer;">
                    Toggle Voice Commands
                </div>
            </div>
        </div>
    </div>

    <!-- Taskbar -->
    <div id="taskbar">
        <div id="start-btn"><i class="fa-brands fa-windows"></i></div>
        <div id="task-view-btn" title="Task View"><i class="fa-solid fa-table-cells-large"></i></div>

        <div class="taskbar-icons">
            <div class="taskbar-icon" data-app="calculator"><i class="fa-solid fa-calculator"></i></div>
            <div class="taskbar-icon" data-app="browser"><i class="fa-solid fa-globe"></i></div>
            <div class="taskbar-icon" data-app="notepad"><i class="fa-solid fa-file-pen"></i></div>
        </div>

        <div class="taskbar-right">
            <div id="voice-toggle" title="Toggle Voice"><i class="fa-solid fa-microphone"></i></div>
            <div id="clock-taskbar">12:00 PM</div>
        </div>
    </div>

    <!-- Start Menu -->
    <div id="start-menu" style="display: none;">
        <div class="start-sidebar">
            <div class="user-profile">
                <div class="avatar"><i class="fa-solid fa-user"></i></div>
                <span>User</span>
            </div>
            <div class="power-btn"><i class="fa-solid fa-power-off"></i></div>
        </div>
        <div class="start-content">
            <div class="start-app" data-app="calculator">
                <i class="fa-solid fa-calculator" style="color: #ff9f43;"></i> Calculator
            </div>
            <div class="start-app" data-app="notepad">
                <i class="fa-solid fa-file-lines" style="color: #54a0ff;"></i> Notepad
            </div>
            <div class="start-app" data-app="browser">
                <i class="fa-solid fa-globe" style="color: #2e86de;"></i> Browser
            </div>
            <div class="start-app" data-app="settings">
                <i class="fa-solid fa-gear" style="color: #5f27cd;"></i> Settings
            </div>
        </div>
    </div>

    <!-- Camera/Canvas Overlays -->
    <video id="camera" autoplay playsinline muted></video>
    <canvas id="output_canvas"></canvas>

    <!-- Gesture Overlay (for visual feedback) -->
    <div id="gesture-overlay"></div>
    <div id="gesture-status">Initializing...</div>

    <!-- Custom Cursor -->
    <div id="custom-cursor"></div>

    <!-- Voice Toast Notification -->
    <div id="voice-toast">Listening...</div>

    <!-- AI Assistant (New Feature) -->
    <div id="ai-assistant-btn" title="Open AI Assistant">
        <i class="fa-solid fa-robot"></i>
    </div>
    <div id="ai-assistant-panel" style="display: none;">
        <div class="ai-header">
            <span>AI Assistant</span>
            <span class="ai-close">&times;</span>
        </div>
        <div class="ai-content">
            <div id="ai-messages">
                <div class="ai-msg ai">Hello! I'm your Gesture Assistant. Ask me anything.</div>
            </div>
            <div class="ai-input-area">
                <input type="text" id="ai-input" placeholder="Type a message..." autocomplete="off">
                <button id="ai-send-btn"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675469240/hands.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1675469215/camera_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1675469215/drawing_utils.js"
        crossorigin="anonymous"></script>

    <!-- Main Application Module -->
    <script type="module" src="main.js?v=2.0.0"></script>

    <!-- CRITICAL FALLBACK: Ensure Loader Hides if JS Fails -->
    <script>
        setTimeout(() => {
            const loader = document.getElementById('loading-screen');
            if (loader && !loader.classList.contains('hidden')) {
                console.warn("ðŸš¨ GLOBAL FALLBACK: Hiding stuck loader via Inline Script");
                loader.style.opacity = '0';
                loader.style.pointerEvents = 'none';
                setTimeout(() => {
                    loader.style.display = 'none';
                    if (loader.parentNode) loader.parentNode.removeChild(loader);
                }, 500);
            }
        }, 3000); // 3 Seconds Max Wait
    </script>
</body>

</html>